@using ShoppingPortal.Web.Models
@using ShoppingPortal.Core.Models
@model ProductListViewModel
@{
    ViewData["Title"] = "Manage Products";
    Layout = "_AdminLayout";
}

<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Manage Products</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        <a asp-action="AddProduct" class="btn btn-sm btn-outline-primary">
            <i class="bi bi-plus-circle"></i> Add Product
        </a>
    </div>
</div>

<div class="card mb-4">
    <div class="card-body">
        <form id="filter-form" method="get">
            <div class="row">
                <!-- Search -->
                <div class="col-md-4 mb-3">
                    <input type="text" class="form-control" name="searchTerm"
                           placeholder="Search products..." value="@Model.SearchTerm">
                </div>

                <!-- Category Filter -->
                <div class="col-md-3 mb-3">
                    <select class="form-select" name="categoryId">
                        <option value="">All Categories</option>
                        @foreach (var category in ViewBag.Categories)
                        {
                            <option value="@category.CategoryId"
                                    selected="@(Model.CategoryId == category.CategoryId)">
                                @category.Name
                            </option>
                        }
                    </select>
                </div>

                <!-- Price Range -->
                <div class="col-md-3 mb-3">
                    <div class="input-group">
                        <input type="number" class="form-control" name="minPrice"
                               placeholder="Min price" value="@Model.MinPrice">
                        <span class="input-group-text">to</span>
                        <input type="number" class="form-control" name="maxPrice"
                               placeholder="Max price" value="@Model.MaxPrice">
                    </div>
                </div>

                <!-- In Stock Toggle -->
                <div class="col-md-2 mb-3">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="inStock"
                               id="inStock" value="true"
                               checked="@(Model.InStock == true)">
                        <label class="form-check-label" for="inStock">
                            In Stock Only
                        </label>
                    </div>
                </div>
            </div>

            <div class="row">
                <!-- Sort Options -->
                <div class="col-md-4 mb-3">
                    <select class="form-select" name="sortBy">
                        <option value="name" selected="@(Model.SortBy == "name")">Name</option>
                        <option value="price" selected="@(Model.SortBy == "price")">Price</option>
                        <option value="date" selected="@(Model.SortBy == "date")">Newest</option>
                    </select>
                </div>

                <!-- Sort Direction -->
                <div class="col-md-2 mb-3">
                    <select class="form-select" name="sortAsc">
                        <option value="true" selected="@(Model.SortAsc)">Ascending</option>
                        <option value="false" selected="@(!Model.SortAsc)">Descending</option>
                    </select>
                </div>

                <!-- Action Buttons -->
                <div class="col-md-6 mb-3 text-end">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-funnel"></i> Apply Filters
                    </button>
                    <a asp-action="Products" asp-controller="Admin" class="btn btn-outline-secondary">
                        <i class="bi bi-x-circle"></i> Clear
                    </a>
                </div>
            </div>
        </form>
    </div>
</div>

<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>Image</th>
                <th>Name</th>
                <th>Price</th>
                <th>Stock</th>
                <th>Categories</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var product in Model.Products)
            {
                <tr>
                    <td>
                        <img src="@product.ImageUrl" class="img-thumbnail" style="width: 50px; height: 50px; object-fit: cover;"
                             onerror="this.src='/images/default-product.webp'" />
                    </td>
                    <td>@product.Name</td>
                    <td>@product.Price.ToString("C")</td>
                    <td>
                        <span class="badge bg-@(product.StockQuantity > 0 ? "success" : "danger")">
                            @product.StockQuantity
                        </span>
                    </td>
                    <td>
                        @if (product.Categories.Any())
                        {
                            <div class="d-flex flex-wrap gap-1">
                                @foreach (var category in product.Categories.Take(2))
                                {
                                    <span class="badge bg-secondary">@category.Name</span>
                                }
                                @if (product.Categories.Count > 2)
                                {
                                    <span class="badge bg-light text-dark">+@(product.Categories.Count - 2)</span>
                                }
                            </div>
                        }
                    </td>
                    <td>
                        <div class="d-flex gap-2">
                            <a asp-action="EditProduct" asp-route-id="@product.ProductId"
                               class="btn btn-sm btn-outline-warning">
                                <i class="bi bi-pencil"></i> Edit
                            </a>
                            <button class="btn btn-sm btn-outline-danger delete-product"
                                    data-id="@product.ProductId">
                                <i class="bi bi-trash"></i> Delete
                            </button>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

